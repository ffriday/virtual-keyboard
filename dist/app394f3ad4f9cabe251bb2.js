(()=>{"use strict";const e=(e="div",t=[],s="")=>{const r=document.createElement(e);return r.className=t.join(" "),r.innerText=s,r},t=[{type:"letter",class:"tilda",ru:"ё",ruS:"Ё",en:"`",enS:"~",rl:!0},{type:"number",ru:"1",ruS:"!",en:"1",enS:"!"},{type:"number",ru:"2",ruS:'"',en:"2",enS:"@"},{type:"number",ru:"3",ruS:"№",en:"3",enS:"#"},{type:"number",ru:"4",ruS:";",en:"4",enS:"$"},{type:"number",ru:"5",ruS:"%",en:"5",enS:"%"},{type:"number",ru:"6",ruS:":",en:"6",enS:"^"},{type:"number",ru:"7",ruS:"?",en:"7",enS:"&"},{type:"number",ru:"8",ruS:"*",en:"8",enS:"*"},{type:"number",ru:"9",ruS:"(",en:"9",enS:"("},{type:"number",ru:"0",ruS:")",en:"0",enS:")"},{type:"number",class:"minus",ru:"-",ruS:"_",en:"-",enS:"_"},{type:"number",class:"plus",ru:"=",ruS:"+",en:"=",enS:"+"},{type:"system",class:"backspace",ru:"Backspace",ruS:"Backspace",en:"Backspace",enS:"Backspace"},{type:"system",class:"tab",ru:"Tab",ruS:"Tab",en:"Tab",enS:"Tab"},{type:"letter",ru:"й",ruS:"Й",en:"q",enS:"Q",rl:!0,el:!0},{type:"letter",ru:"ц",ruS:"Ц",en:"w",enS:"W",rl:!0,el:!0},{type:"letter",ru:"у",ruS:"У",en:"e",enS:"E",rl:!0,el:!0},{type:"letter",ru:"к",ruS:"К",en:"r",enS:"R",rl:!0,el:!0},{type:"letter",ru:"е",ruS:"Е",en:"t",enS:"T",rl:!0,el:!0},{type:"letter",ru:"н",ruS:"Н",en:"y",enS:"Y",rl:!0,el:!0},{type:"letter",ru:"г",ruS:"Г",en:"u",enS:"U",rl:!0,el:!0},{type:"letter",ru:"ш",ruS:"Ш",en:"i",enS:"I",rl:!0,el:!0},{type:"letter",ru:"щ",ruS:"Щ",en:"o",enS:"O",rl:!0,el:!0},{type:"letter",ru:"з",ruS:"З",en:"p",enS:"P",rl:!0,el:!0},{type:"letter",ru:"х",ruS:"Х",en:"[",enS:"{",rl:!0},{type:"letter",ru:"ъ",ruS:"Ъ",en:"]",enS:"}",rl:!0},{type:"letter",ru:"\\",ruS:"/",en:"\\",enS:"/"},{type:"system",class:"del",ru:"Del",ruS:"Del",en:"Del",enS:"Del"},{type:"system",class:"capslock",ru:"CapsLock",ruS:"CapsLock",en:"CapsLock",enS:"CapsLock"},{type:"letter",ru:"ф",ruS:"Ф",en:"a",enS:"A",rl:!0,el:!0},{type:"letter",ru:"ы",ruS:"Ы",en:"s",enS:"S",rl:!0,el:!0},{type:"letter",ru:"в",ruS:"В",en:"d",enS:"D",rl:!0,el:!0},{type:"letter",ru:"а",ruS:"А",en:"f",enS:"F",rl:!0,el:!0},{type:"letter",ru:"п",ruS:"П",en:"g",enS:"G",rl:!0,el:!0},{type:"letter",ru:"р",ruS:"Р",en:"h",enS:"H",rl:!0,el:!0},{type:"letter",ru:"о",ruS:"О",en:"j",enS:"J",rl:!0,el:!0},{type:"letter",ru:"л",ruS:"Л",en:"k",enS:"K",rl:!0,el:!0},{type:"letter",ru:"д",ruS:"Д",en:"l",enS:"L",rl:!0,el:!0},{type:"letter",ru:"ж",ruS:"Ж",en:";",enS:":",rl:!0,el:!0},{type:"letter",ru:"э",ruS:"Э",en:"'",enS:'"',rl:!0},{type:"system",class:"enter",ru:"Enter",ruS:"Enter",en:"Enter",enS:"Enter"},{type:"system",class:"shiftL",ru:"Shift",ruS:"Shift",en:"Shift",enS:"Shift"},{type:"letter",ru:"я",ruS:"Я",en:"z",enS:"Z",rl:!0,el:!0},{type:"letter",ru:"ч",ruS:"Ч",en:"x",enS:"X",rl:!0,el:!0},{type:"letter",ru:"с",ruS:"С",en:"c",enS:"C",rl:!0,el:!0},{type:"letter",ru:"м",ruS:"М",en:"v",enS:"V",rl:!0,el:!0},{type:"letter",ru:"и",ruS:"И",en:"b",enS:"B",rl:!0,el:!0},{type:"letter",ru:"т",ruS:"Т",en:"n",enS:"N",rl:!0,el:!0},{type:"letter",ru:"ь",ruS:"Ь",en:"m",enS:"M",rl:!0,el:!0},{type:"letter",ru:"б",ruS:"Б",en:",",enS:"<",rl:!0},{type:"letter",ru:"ю",ruS:"Ю",en:".",enS:">",rl:!0},{type:"letter",ru:".",ruS:",",en:"/",enS:"?"},{type:"system",class:"arrowUP",ru:"▲",ruS:"▲",en:"▲",enS:"▲"},{type:"system",class:"shiftR",ru:"Shift",ruS:"Shift",en:"Shift",enS:"Shift"},{type:"system",class:"ctrlL",ru:"Ctrl",ruS:"Ctrl",en:"Ctrl",enS:"Ctrl"},{type:"system",class:"win",ru:"Win",ruS:"Win",en:"Win",enS:"Win"},{type:"system",class:"altL",ru:"Alt",ruS:"Alt",en:"Alt",enS:"Alt"},{type:"system",class:"space",ru:" ",ruS:" ",en:" ",enS:" "},{type:"system",class:"altR",ru:"Alt",ruS:"Alt",en:"Alt",enS:"Alt"},{type:"system",class:"arrowLEFT",ru:"◄",ruS:"◄",en:"◄",enS:"◄"},{type:"system",class:"arrowDOWN",ru:"▼",ruS:"▼",en:"▼",enS:"▼"},{type:"system",class:"arrowRIGHT",ru:"►",ruS:"►",en:"►",enS:"►"},{type:"system",class:"ctrlR",ru:"Ctrl",ruS:"Ctrl",en:"Ctrl",enS:"Ctrl"}];let s="ru";window.localStorage.getItem("lang")&&(s=window.localStorage.getItem("lang")),new class{constructor(t="ru"){this.lang=t,this.shift=!1,this.caps=!1,this.mode=t,this.cursor=0,this.hintText="Если язык клавиатуры не совпадает с языком в системе - \n        после начала воода с клавиатуры язык изменится.\n        При нажатии мышкой Shift залипает, после нажатия символа - отлипает (как в телефоне). \n        Поддерживаемые раскладки: русская, английская.",this.container=e("main",["container"]),this.caption=e("h1",["container__caption"],"Виртуальная клавиатура"),this.text=e("textarea",["container__text"]),this.text.cols="98",this.text.rows="20",this.key=e("section",["keyboard"]),this.info=e("h2",["container__info"],"Переключение языка left Shift + Alt"),this.hint=e("span",["container__hint"],this.hintText),this.mouseClickEvent=this.key.addEventListener("mousedown",(e=>this.mouseClickHandler(e.target))),this.mouseUpEvent=this.key.addEventListener("mouseup",(e=>e.target.classList.remove("active"))),this.textCliclEvent=this.text.addEventListener("click",(e=>this.textClickHandler(e,this))),this.keyDownEvent=window.addEventListener("keydown",(e=>this.keyDownHandler(e))),this.keyUpEvent=window.addEventListener("keyup",(e=>this.keyUpHandler(e)))}render(e=document.body){this.root=e,this.buttons=this.renderButtons(t),this.key.append(...this.buttons.map((e=>e.element))),this.container.append(this.caption,this.text,this.key,this.info,this.hint),this.root.append(this.container),this.elCaps=this.key.querySelector(".capslock"),this.elShiftL=this.key.querySelector(".shiftL"),this.elShiftR=this.key.querySelector(".shiftR"),this.text.focus()}changeMode(){this.shift?this.caps?this.mode=this.lang:this.mode=`${this.lang}S`:this.shift||(this.caps?this.mode=`${this.lang}S`:this.mode=this.lang)}changeKeys(e){this.changeMode(),window.localStorage.setItem("lang",this.lang);const t="ru"===this.lang?"rl":"el";this.buttons=this.buttons.map((s=>{const r=s;if(e)s.key[t]&&(r.element.innerText=s.key[this.mode]);else{const e=this.shift?`${this.lang}S`:this.lang;s.key[t]?r.element.innerText=s.key[this.mode]:r.element.innerText=s.key[e]}return s})),this.shift?(this.elShiftL.classList.add("stick"),this.elShiftR.classList.add("stick")):(this.elShiftL.classList.remove("stick"),this.elShiftR.classList.remove("stick")),this.caps?this.elCaps.classList.add("stick"):this.elCaps.classList.remove("stick")}renderButtons(t){const s=Array(t.length);return t.forEach(((t,r)=>{s[r]=new class{constructor(e,t="ru"){this.key=e,this.lang=t,this.element=this.render()}render(){const t=this.key.class?this.key.class:this.key.type+this.key.en;return e("div",["basic-key",this.key.type,t],this.key[this.lang])}}(t,this.lang),s[r].mouseOutEvent=s[r].element.addEventListener("mouseout",(e=>e.target.classList.remove("active")))})),s}mouseClickHandler(e){if("basic-key"===e.classList[0]){const t=e.classList[1],s=e.classList[2],{innerText:r}=e,{value:n}=this.text;e.classList.add("active"),"letter"!==t&&"number"!==t||this.addText(r),"backspace"===s&&this.cursor>0&&(this.text.value=n.slice(0,this.cursor-1)+n.slice(this.cursor),this.cursor=this.cursor>0?this.cursor-=1:0),"del"===s&&this.cursor<this.text.value.length&&(this.text.value=n.slice(0,this.cursor)+n.slice(this.cursor+1),this.cursor=this.cursor<this.text.value.length?this.cursor:this.text.value.length),"enter"===s&&this.addText("\r\n",1),"tab"===s&&this.addText("    "),"space"===s&&this.addText(" "),s.length>5&&"arrow"===s.slice(0,5)&&this.addText(r),"capslock"===s&&(this.caps=!this.caps,this.changeKeys(!0)),"shiftL"!==s&&"shiftR"!==s||(this.shift=!this.shift,this.changeKeys()),"shiftL"!==s&&"shiftR"!==s&&(this.shift=!1,this.changeKeys()),this.text.focus(),this.text.selectionStart=this.cursor,this.text.selectionEnd=this.cursor}}addText(e,t=0){const s=t||e.length;this.text.value=this.text.value.slice(0,this.cursor)+e+this.text.value.slice(this.cursor),this.cursor+=s}textClickHandler(e,t){t.cursor=this.text.selectionStart}getElement(e){const t={Control:"Ctrl",AltGraph:"Alt",Meta:"Win",Delete:"Del",ArrowUp:"▲",ArrowDown:"▼",ArrowLeft:"◄",ArrowRight:"►"},s=0===e.location?0:e.location-1,r=t[e.key]?t[e.key]:e.key;let n=null;if(this.buttons.filter((e=>e.key[this.mode]===r)).length)n=this.buttons.filter((e=>e.key[this.mode]===r))[s];else{const e="ru"===this.lang?"en":"ru";this.buttons.filter((t=>t.key[e]===r)).length&&(this.lang=e,this.changeKeys(!1),n=this.buttons.filter((e=>e.key[this.mode]===r))[s])}return n?n.element:null}keyDownHandler(e){e.preventDefault(),e.stopPropagation(),this.shift=e.getModifierState("Shift"),this.caps=e.getModifierState("CapsLock");const t=this.getElement(e);t&&(this.mouseClickHandler(t),this.changeKeys("CapsLock"===e.key)),"AltGraph"===e.key&&this.key.querySelector(".ctrlL").classList.remove("active")}keyUpHandler(e){e.preventDefault(),e.stopPropagation(),this.shift=e.getModifierState("Shift"),this.caps=e.getModifierState("CapsLock"),this.changeKeys("CapsLock"===e.key);const t=this.getElement(e);t&&t.classList.remove("active"),"Alt"===e.key&&1===e.location&&e.getModifierState("Shift")&&(this.lang="ru"===this.lang?"en":"ru",this.changeKeys()),"Shift"===e.key&&1===e.location&&e.getModifierState("Alt")&&(this.lang="ru"===this.lang?"en":"ru",this.changeKeys())}}(s).render()})();